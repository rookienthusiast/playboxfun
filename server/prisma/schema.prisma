// Prisma DB
generator client {
  provider = "prisma-client-js" 
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        Int      @id @default(autoincrement())
  name      String   // Nama anak (misal: "Budi")
  balance   Int      @default(0) // Saldo total anak saat ini
  
  // Gamification & Avatar Customization
  xp            Int      @default(0)
  puzzlePieces  Int      @default(0)
  
  // Equipped Items (Apa yang sedang dipakai)
  equippedBase      String   @default("base") // Seed dasar
  equippedHair      String   @default("shortFlat") 
  equippedHairColor String   @default("2c1b18") // Default Hitam
  equippedClothing  String   @default("shirtCrewNeck")
  equippedAccessory String   @default("none")

  claimedBoxes  String   @default("") 
  
  cards     UserCard[]
  events    MoneyInEvent[]
  inventory UserItem[] // Ganti UserAvatar jadi Inventory
}

model UserCard {
  uid       String   @id // UID dari RFID (A1B2C3D4)
  user      User     @relation(fields: [userId], references: [id])
  userId    Int
}

// Model Inventory (Barang yang dimiliki user)
model UserItem {
  id        Int      @id @default(autoincrement())
  userId    Int
  user      User     @relation(fields: [userId], references: [id])
  
  itemId    String   // ID Unik Barang (misal: "hair-curly", "shirt-red")
  category  String   // Jenis: "hair", "clothing", "accessory"
  
  unlockedAt DateTime @default(now())

  @@unique([userId, itemId]) // User gak bisa punya 2 barang yg sama
}

model MoneyInEvent {
  id          Int      @id @default(autoincrement())
  deviceId    String   // ID Mesin (KUCING-01)
  userId      Int
  user        User     @relation(fields: [userId], references: [id])
  amount_rp   Int      // Uang yang barusan dimasukkan
  saldo_after Int      // Total saldo setelah uang masuk (untuk audit)
  createdAt   DateTime @default(now())
}